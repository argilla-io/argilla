import { shallowMount } from "@vue/test-utils";
import EntityHighlightComponent from "./EntityHighlight";

jest.mock("@/models/viewSettings.queries", () => ({
  getViewSettingsByDatasetName: () => ({
    $id: "medical-keywords",
    id: "medical-keywords",
    pagination: null,
    viewMode: "annotate",
    loading: false,
    headerHeight: 288,
    visibleMetrics: false,
    visibleRulesList: false,
  }),
}));

let wrapper = null;

const filterHtmlText = (text) => {
  return text
    .toString()
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;");
};
const filterhtmlHighlightText = (text) => {
  return `<span class="highlight-text">${filterHtmlText(text)}</span>`;
};

const options = {
  mocks: {
    $htmlText: filterHtmlText,
    $htmlHighlightText: filterhtmlHighlightText,
  },
  propsData: {
    span: {
      entity: {
        start: 31,
        end: 36,
        label: "LOC",
        score: 1,
        origin: "annotation",
        start_token: 7,
        end_token: 8,
      },
      tokens: [
        {
          start: 31,
          end: 36,
          highlighted: false,
          text: "CHINA",
          charsBetweenTokens: " ",
        },
        {
          start: 38,
          end: 47,
          highlighted: false,
          text: "pregnancy",
          charsBetweenTokens: " ",
        },
      ],
      start: 31,
      end: 36,
      origin: "annotation",
    },
    whiteSpace: null,
    datasetName: "name",
    record: {
      id: 10,
      metadata: {},
      annotation: {
        agent: "Danis-MacBook-Pro.local",
        entities: [
          {
            start: 0,
            end: 13,
            label: "PER",
            score: 1,
          },
          {
            start: 70,
            end: 90,
            label: "PER",
            score: 1,
          },
          {
            start: 109,
            end: 115,
            label: "MISC",
            score: 1,
          },
          {
            start: 138,
            end: 149,
            label: "PER",
            score: 1,
          },
        ],
      },
      status: "Discarded",
      selected: false,
      event_timestamp: "2022-12-21T09:52:24.115037",
      vectors: {
        "mini-lm-sentence-transformers": {
          value: [
            -0.1186927929520607, 0.31512293219566345, -0.16946278512477875,
            -0.0641435980796814, 0.17446641623973846, 0.3161347806453705,
            0.24799305200576782, 0.2863616347312927, 0.10223839432001114,
            0.2566393315792084, -0.013719785027205944, -0.28332164883613586,
            -0.02659071423113346, 0.23208647966384888, -0.08777270466089249,
            -0.1417364627122879, -0.22905981540679932, 0.07554126530885696,
            -0.05198162421584129, -0.28429198265075684, 0.01754136197268963,
            -0.0958814024925232, 0.10372427105903625, -0.06957829743623734,
            0.1047639474272728, -0.12809091806411743, 0.038079649209976196,
            -0.1446269005537033, 0.03256510570645332, -0.09028351306915283,
            -0.06897050142288208, -0.20071077346801758, -0.052312105894088745,
            -0.03451123461127281, -0.31281569600105286, 0.20795442163944244,
            -0.0177654717117548, 0.03514968231320381, -0.04469631239771843,
            -0.07261297106742859, -0.13511057198047638, -0.006304600741714239,
            -0.07253265380859375, 0.0029106896836310625, 0.2821636497974396,
            0.06338273733854294, 0.08461558818817139, -0.16795557737350464,
            0.19685597717761993, 0.03728748485445976, -0.01276024803519249,
            0.05379841849207878, 0.14519521594047546, 0.15668122470378876,
            0.06167125701904297, 0.01418036688119173, 0.11112004518508911,
            0.05288681387901306, -0.01858573779463768, 0.08425434678792953,
            -0.07003331929445267, -0.22677278518676758, -0.0007196329534053802,
            -0.16362911462783813, -0.01909250020980835, -0.32082417607307434,
            -0.04475419595837593, -0.004961246624588966, -0.13744355738162994,
            0.10135015845298767, 0.158981055021286, 0.14429816603660583,
            0.012676007114350796, -0.20508290827274323, 0.018575137481093407,
            -0.08847393840551376, -0.06088356301188469, -0.07800154387950897,
            -0.023128071799874306, 0.09917005151510239, 0.1371372491121292,
            -0.003595138667151332, 0.020748088136315346, -0.017347993329167366,
            0.35864678025245667, 0.11228988319635391, -0.11140137165784836,
            0.15473319590091705, 0.17832553386688232, 0.0094894515350461,
            0.017582472413778305, 0.16326992213726044, -0.02456531673669815,
            0.07372987270355225, 0.1327420026063919, -0.2346634417772293,
            0.042300645262002945, 0.11193669587373734, 0.05647896230220795,
            0.06505606323480606, 0.1546649932861328, 0.06749396026134491,
            -0.280772864818573, 0.14163321256637573, 0.2339286208152771,
            0.12799657881259918, 0.18657349050045013, -0.02907375805079937,
            -0.003460062900558114, -0.024650126695632935, -0.08851883560419083,
            0.03832658752799034, 0.18772991001605988, 0.13887566328048706,
            -0.20531319081783295, -0.05883260443806648, -0.16278788447380066,
            0.07252044230699539, 0.0873081162571907, 0.07913035899400711,
            0.06531546264886856, 0.0801108330488205, -0.06419873982667923,
            -0.0007133893668651581, 0.005701124668121338, 0.19515250623226166,
            0.2665781080722809, 1.0339154602205496e-32, 0.17634332180023193,
            -0.06360078603029251, -0.03382332623004913, 0.0656772181391716,
            -0.11252164095640182, -0.06594694405794144, -0.12240833044052124,
            -0.09381058812141418, -0.24207903444766998, -0.0899602472782135,
            -0.21652118861675262, -0.11666736751794815, -0.19810311496257782,
            -0.26178959012031555, 0.07555148750543594, -0.0007152290199883282,
            -0.11361250281333923, -0.07036421447992325, -0.04024433717131615,
            0.20687837898731232, -0.0364840030670166, 0.03664946183562279,
            -0.1395561546087265, -0.14093135297298431, -0.03805244341492653,
            0.2961353063583374, -0.09707624465227127, -0.1675739288330078,
            0.02061358280479908, 0.032682061195373535, -0.09225127100944519,
            -0.34233781695365906, -0.2793814241886139, 0.17457348108291626,
            -0.07123451679944992, -0.08077090978622437, -0.08691395074129105,
            -0.0471937358379364, -0.1353587955236435, 0.14412759244441986,
            0.016843806952238083, -0.006812716368585825, 0.028847284615039825,
            -0.1818981021642685, -0.08845644444227219, -0.09503362327814102,
            -0.1923922747373581, -0.0832662358880043, 0.12078171968460083,
            0.14926846325397491, -0.01648831181228161, 0.09902837872505188,
            -0.02631145715713501, 0.047571659088134766, 0.02131541632115841,
            0.14623956382274628, 0.09130915999412537, -0.03890271857380867,
            -0.04034382477402687, 0.31092357635498047, -0.03133771941065788,
            0.03400800749659538, -0.042158979922533035, -0.00816373061388731,
            -0.15100060403347015, -0.14121462404727936, 0.11204385757446289,
            -0.06402774155139923, -0.002677975222468376, -0.05624966695904732,
            -0.2601229250431061, -0.07168657332658768, -0.023059308528900146,
            0.1521795243024826, 0.017322571948170662, -0.0761837288737297,
            -0.006268584635108709, -0.019882163032889366, -0.1771516352891922,
            -0.0736670270562172, 0.040520910173654556, 0.029164938256144524,
            0.09382650256156921, -0.0913192555308342, -0.06523364782333374,
            0.18301451206207275, 0.012167364358901978, -0.051567960530519485,
            -0.2558635175228119, -0.04740298166871071, 0.0000628462657914497,
            0.24512352049350739, 0.0830523893237114, 0.041002895683050156,
            -0.2587677240371704, -9.476147057450082e-33, 0.002309729577973485,
            0.04462838172912598, 0.050188567489385605, -0.1752176284790039,
            -0.027055524289608, 0.0635574460029602, -0.010185482911765575,
            0.002612970070913434, -0.07887846976518631, 0.02174992673099041,
            0.2647891342639923, -0.1704680174589157, 0.02358592301607132,
            0.18535208702087402, -0.04214624688029289, -0.1409229189157486,
            0.2926253080368042, 0.17375050485134125, -0.09724848717451096,
            -0.18201738595962524, 0.2531740367412567, -0.14456166326999664,
            -0.038365814834833145, -0.17904363572597504, -0.21638548374176025,
            0.14229418337345123, 0.21357357501983643, 0.12680315971374512,
            -0.178052619099617, 0.0030528903007507324, 0.14602763950824738,
            -0.20857423543930054, 0.02051563374698162, 0.04735864698886871,
            0.11931554228067398, 0.1267746537923813, -0.08347014337778091,
            -0.00267043081112206, 0.007311432156711817, 0.2952876389026642,
            0.2843426764011383, 0.07836322486400604, -0.14795967936515808,
            0.22050447762012482, -0.13663458824157715, 0.05107559263706207,
            -0.2146422266960144, 0.07250708341598511, 0.1081630289554596,
            -0.15479746460914612, 0.09091484546661377, 0.09408027678728104,
            -0.010724641382694244, 0.021025732159614563, -0.01971852034330368,
            -0.0558914840221405, -0.09923849254846573, -0.15047188103199005,
            0.12450142949819565, 0.07225446403026581, 0.009659725241363049,
            0.06096513941884041, -0.1650853157043457, 0.02830543927848339,
            0.14568136632442474, 0.13174273073673248, 0.07871842384338379,
            -0.0030401928815990686, -0.021425776183605194, 0.11939004808664322,
            0.05309619382023811, 0.23252396285533905, 0.011611285619437695,
            -0.013842378742992878, -0.05444885417819023, 0.1537110060453415,
            -0.0995016023516655, 0.3482232391834259, 0.23774869740009308,
            -0.06708604842424393, 0.04114415869116783, 0.06259596347808838,
            -0.023538345471024513, -0.03386331722140312, 0.14099539816379547,
            0.09449192881584167, 0.12866903841495514, -0.26515352725982666,
            -0.07375176250934601, -0.1984802484512329, 0.16238443553447723,
            0.16373451054096222, 0.1908552050590515, 0.19933533668518066,
            0.021773362532258034, -9.856808702579656e-8, -0.05992770195007324,
            -0.007337498012930155, -0.36738482117652893, -0.16401420533657074,
            -0.3205412030220032, 0.21308346092700958, -0.13468104600906372,
            -0.29393312335014343, -0.09267468005418777, -0.019118841737508774,
            -0.0377899594604969, 0.19617325067520142, 0.09297575801610947,
            0.11565569788217545, -0.1250869780778885, -0.04620547965168953,
            -0.15421290695667267, 0.04040515795350075, 0.10106269270181656,
            0.04864406958222389, 0.23889221251010895, -0.02132999897003174,
            -0.2380724549293518, -0.2624034285545349, -0.05965187028050423,
            0.2806686758995056, -0.2191251516342163, 0.2381666749715805,
            -0.14768894016742706, -0.10893884301185608, 0.02622379921376705,
            0.0801708772778511, -0.1514585316181183, -0.009691613726317883,
            0.02463323064148426, 0.12230363488197327, -0.04168952628970146,
            0.0386476032435894, 0.011329243890941143, -0.11110919713973999,
            -0.010117457248270512, 0.17526893317699432, 0.04695767164230347,
            0.0025554087478667498, 0.09363096207380295, 0.08420900255441666,
            0.04239064082503319, -0.13354159891605377, -0.003065114840865135,
            -0.18164175748825073, 0.18293136358261108, -0.07281696051359177,
            0.1557992845773697, 0.14928443729877472, -0.0015756388893350959,
            -0.17691147327423096, -0.06173444911837578, -0.25367167592048645,
            -0.14289003610610962, -0.008584132418036461, -0.09555866569280624,
            -0.0809999629855156, -0.03246486186981201, 0.17268270254135132,
          ],
        },
      },
      last_updated: "2023-01-11T16:31:08.415487",
      search_keywords: [],
      tokens: [
        "Takuya",
        "Takagi",
        "scored",
        "the",
        "winner",
        "in",
        "the",
        "88th",
        "minute",
        ",",
        "rising",
        "to",
        "head",
        "a",
        "Hiroshige",
        "Yanagimoto",
        "cross",
        "towards",
        "the",
        "Syrian",
        "goal",
        "which",
        "goalkeeper",
        "Salem",
        "Bitar",
        "appeared",
        "to",
        "have",
        "covered",
        "but",
        "then",
        "allowed",
        "to",
        "slip",
        "into",
        "the",
        "net",
        ".",
      ],
      text: "Takuya Takagi scored the winner in the 88th minute , rising to head a Hiroshige Yanagimoto cross towards the Syrian goal which goalkeeper Salem Bitar appeared to have covered but then allowed to slip into the net .",
      annotatedEntities: [
        {
          start: 0,
          end: 13,
          label: "PER",
          score: 1,
          origin: "annotation",
        },
        {
          start: 70,
          end: 90,
          label: "PER",
          score: 1,
          origin: "annotation",
        },
        {
          start: 109,
          end: 115,
          label: "MISC",
          score: 1,
          origin: "annotation",
        },
        {
          start: 138,
          end: 149,
          label: "PER",
          score: 1,
          origin: "annotation",
        },
      ],
    },
  },
};

beforeEach(() => {
  wrapper = shallowMount(EntityHighlightComponent, options);
});

afterEach(() => {
  wrapper.destroy();
});

describe("EntityHighlightComponent", () => {
  it("render the component", () => {
    // FIXME: mock vuexorm viewsettings
    expect(wrapper.is(EntityHighlightComponent)).toBe(true);
  });
});
